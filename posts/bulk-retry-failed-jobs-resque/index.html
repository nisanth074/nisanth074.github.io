<html>
  <head>
  <link rel="stylesheet" href="https://nisanth074.github.io//bower_components/normalize.css/normalize.css">
  
  <link rel="stylesheet" href="https://nisanth074.github.io//css/digitalocean.css">

  <link rel="stylesheet" href="https://nisanth074.github.io//bower_components/highlightjs/styles/github.css">
  <script src="https://nisanth074.github.io//bower_components/highlightjs/highlight.pack.js"></script>
  <script src="https://nisanth074.github.io//bower_components/zepto/zepto.min.js"></script>
  <script src="https://nisanth074.github.io//js/initHighlightingOnLoad.js"></script>
</head>


  <div class="main">
    <div class="header">
  <a href="/">Nisanth's Blog</a>
</div>


    <div class="postsContainer fadeInUp">
      <div class="post">
        <h1 class="postTitle">Bulk retry failed jobs in resque 1.x</h1>

        <p class="postDate">Thu, Jan 8, 2015</p>

        <div class="postContent"><p>Retrying failed jobs via Resque’s web interface is pretty tiresome, especially when there are more than a handful of them. So I’ve quickly written down a small script that’ll do it for me.</p>

<p>Copy the snippet below and paste it in a rails console</p>

<pre><code class="language-ruby">def retry_if(&amp;should_retry)
  redis = Resque.redis

  (0...Resque::Failure.count).each do |i|
    serialized_job = redis.lindex(:failed, i)
    job = Resque.decode(serialized_job)

    next unless should_retry.(job)
    Resque::Failure.requeue(i)
  end
end
</code></pre>

<p>To retry a subset of failed jobs, say email notifications that have failed because of smtp errors</p>

<pre><code class="language-ruby">retry_if do |job|
  job['payload']['class'] == 'SendEmailNotifications' &amp;&amp; job['exception'] == 'Net::SMTPServerBusy'
end
</code></pre>

<p>If you want to skip jobs that have already been retried</p>

<pre><code class="language-ruby">retry_if do |job|
  if job['payload']['class'] == 'SendEmailNotifications' &amp;&amp; job['exception'] == 'Net::SMTPServerBusy'
    if !job['retried_at']
      next true
    end
  end

  false
end
</code></pre>

<p>I might eventually move this to a rake task, but that’s a blog post for the future.</p>
</div>
      </div>
    </div>

    <div class="footer fadeInUp">
  <p>
    Built with <a href="http://gohugo.io/">Hugo</a>
   </p>
</div>

  </div>
</html>
